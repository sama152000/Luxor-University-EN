<app-page-header></app-page-header>
<section class="org-structure-section">
  <div class="container-fluid">
    <!-- Top Section -->
    <div class="top-section">
      <div class="title-container">
        <h1 class="main-title">Luxor University Organizational Structure</h1>
        <p class="subtext">Explore our comprehensive administrative hierarchy and departmental organization</p>
      </div>
      <div class="action-buttons">
        <button class="download-btn" (click)="downloadPDF()">
          <i class="pi pi-download"></i>
          ðŸ“„ Download PDF
        </button>
      </div>
    </div>

    <!-- Main Layout -->
    <div class="main-layout">
      <!-- ðŸ“Š Main Content -->
      <main class="org-main">
        <!-- Zoom Controls -->
        <div class="zoom-controls">
          <button class="zoom-btn" (click)="zoomIn()" title="Zoom In">
            <i class="pi pi-plus"></i>
          </button>
          <button class="zoom-btn" (click)="zoomOut()" title="Zoom Out">
            <i class="pi pi-minus"></i>
          </button>
          <button class="zoom-btn" (click)="resetZoom()" title="Reset Zoom">
            <i class="pi pi-refresh"></i>
          </button>
        </div>

        <!-- Hierarchy Chart -->
        <article class="chart-card">
          <div class="card-header">
            <div class="card-icon-wrapper">
              <i class="pi pi-sitemap"></i>
            </div>
            <div class="card-badge">Hierarchy</div>
          </div>

          <div class="card-body">
            <h2 class="card-title">Luxor University Hierarchy</h2>
            <p class="card-description">Interactive organizational chart showing administrative structure</p>

            <div class="chart-container" [style.transform]="'scale(' + zoomScale + ') translate(' + zoomTranslate.x + 'px, ' + zoomTranslate.y + 'px)'">
              <!-- ðŸ”¥ CUSTOM GOLDEN TREE -->
              <div class="custom-tree">
                <ng-container *ngFor="let node of orgChart; let i = index">
                  <div class="tree-node" [attr.data-level]="0">
                    <div class="node-header" (click)="toggleNode(node, i)">
                      <div class="node-toggle">
                        <i *ngIf="node.children?.length"
                           class="pi"
                           [class.pi-chevron-down]="!node.expanded"
                           [class.pi-chevron-up]="node.expanded"></i>
                      </div>
                      <div class="node-icon"><i [class]="getNodeIcon(node)"></i></div>
                      <span class="node-label">{{ node.label }}</span>
                    </div>

                    <ng-container *ngIf="node.children?.length">
                      <div class="children-container" [class.expanded]="node.expanded">
                        <div class="child-line"></div>
                        <div class="children-wrapper">
                          <ng-container *ngFor="let child of node.children; let j = index">
                            <div class="tree-node" [attr.data-level]="1">
                              <div class="node-header" (click)="toggleNode(child, j, true)">
                                <div class="node-toggle child-toggle">
                                  <i *ngIf="child.children?.length"
                                     class="pi"
                                     [class.pi-chevron-down]="!child.expanded"
                                     [class.pi-chevron-up]="child.expanded"></i>
                                </div>
                                <div class="node-icon"><i [class]="getNodeIcon(child)"></i></div>
                                <span class="node-label">{{ child.label }}</span>
                              </div>

                              <ng-container *ngIf="child.children?.length">
                                <div class="children-container" [class.expanded]="child.expanded">
                                  <div class="child-line"></div>
                                  <div class="children-wrapper">
                                    <ng-container *ngFor="let leaf of child.children">
                                      <div class="tree-node leaf-node">
                                        <div class="node-header selected-able" (click)="onNodeSelect({node: leaf})">
                                          <div class="node-toggle"></div>
                                          <div class="node-icon"><i [class]="getNodeIcon(leaf)"></i></div>
                                          <span class="node-label">{{ leaf.label }}</span>
                                        </div>
                                      </div>
                                    </ng-container>
                                  </div>
                                </div>
                              </ng-container>
                            </div>
                          </ng-container>
                        </div>
                      </div>
                    </ng-container>
                  </div>
                </ng-container>
              </div>
            </div>
          </div>

          <div class="card-decoration">
            <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
              <path d="M0 100 L50 50 L100 100 Z" fill="currentColor" opacity="0.05"/>
            </svg>
          </div>
        </article>

        <!-- Legend -->
        <div class="legend">
          <h3>Legend</h3>
          <div class="legend-items">
            <div class="legend-item">
              <i class="pi pi-crown"></i>
              <span>University President</span>
            </div>
            <div class="legend-item">
              <i class="pi pi-star"></i>
              <span>Vice President</span>
            </div>
            <div class="legend-item">
              <i class="pi pi-briefcase"></i>
              <span>Secretary-General</span>
            </div>
            <div class="legend-item">
              <i class="pi pi-user-plus"></i>
              <span>Deputy Secretary</span>
            </div>
            <div class="legend-item">
              <i class="pi pi-building"></i>
              <span>Department</span>
            </div>
            <div class="legend-item">
              <i class="pi pi-folder"></i>
              <span>Sub-Department</span>
            </div>
            <div class="legend-item">
              <i class="pi pi-info-circle"></i>
              <span>Advisor</span>
            </div>
          </div>
        </div>
      </main>

      <!-- Sidebar -->
      <aside class="sidebar" [class.visible]="isSidebarVisible">
        <div class="sidebar-header">
          <h3>Department Details</h3>
          <button class="close-btn" (click)="closeSidebar()">
            <i class="pi pi-times"></i>
          </button>
        </div>
        <div class="sidebar-content">
          <ng-container *ngIf="selectedNode">
            <div class="node-info">
              <div class="node-icon-large">
                <i [class]="getNodeIcon({data: selectedNode})"></i>
              </div>
              <h4>{{ selectedNode.name }}</h4>
              <p class="position">{{ selectedNode.position }}</p>
              <ng-container *ngIf="selectedDepartment">
                <div class="department-details">
                  <h5>Department Information</h5>
                  <p><strong>Director:</strong> {{ selectedDepartment.director }}</p>
                  <p><strong>Team:</strong> {{ selectedDepartment.team.join(', ') }}</p>
                  <div class="responsibilities">
                    <h6>Responsibilities:</h6>
                    <ul>
                      <li *ngFor="let resp of selectedDepartment.responsibilities">{{ resp }}</li>
                    </ul>
                  </div>
                  <div class="vision-mission">
                    <p><strong>Vision:</strong> {{ selectedDepartment.vision }}</p>
                    <p><strong>Mission:</strong> {{ selectedDepartment.mission }}</p>
                  </div>
                </div>
              </ng-container>
            </div>
          </ng-container>
          <ng-container *ngIf="!selectedNode">
            <p class="no-selection">Click on a department to view details</p>
          </ng-container>
        </div>
      </aside>
    </div>

    <!-- Watermark -->
    <div class="watermark">
      <img src="./assets/Logo.png" alt="Luxor University Logo" />
    </div>
  </div>
</section>

<app-footer></app-footer>
